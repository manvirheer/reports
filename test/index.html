<script>
let fileContents = `"Tour","Account Uid","Account","Employee","Result","Start Time","End  Time","Duration (min)","Delta","Tour Incomplete Reason"
"Patio/Exterior Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Manvir Heer","5 of 5","2021-07-03 11:24","11:31","6.5","",""
"Parkade Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Manvir Heer","30 of 30","2021-07-03 11:10","11:24","13.8","",""
"Tower Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Sahibjot Singh","37 of 37","2021-07-03 09:41","10:27","46.8","",""
"Parkade Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Sahibjot Singh","30 of 30","2021-07-03 08:30","08:46","16.1","",""
"Patio/Exterior Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Sahibjot Singh","5 of 5","2021-07-03 08:24","08:30","5.1","",""
"Parkade Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Suncica Rakic","30 of 30","2021-07-02 23:06","23:24","18","",""
"Patio/Exterior Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Suncica Rakic","5 of 5","2021-07-02 22:59","23:06","7.9","",""
"Tower Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Casey Leung","37 of 37","2021-07-02 21:56","22:54","57.8","",""
"Parkade Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Suncica Rakic","30 of 30","2021-07-02 20:48","21:08","19.4","",""
"Patio/Exterior Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Suncica Rakic","4 of 5","2021-07-02 20:42","20:48","6.3","","done"
"Parkade Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Casey Leung","30 of 30","2021-07-02 19:44","20:01","17","",""
"Patio/Exterior Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Casey Leung","5 of 5","2021-07-02 19:36","19:44","8.5","",""
"Tower Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Suncica Rakic","37 of 37","2021-07-02 18:44","19:28","44","",""
"Parkade Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Casey Leung","30 of 30","2021-07-02 18:17","18:42","24.5","",""
"Patio/Exterior Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Casey Leung","5 of 5","2021-07-02 18:02","18:17","14.8","",""
"Parkade Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Suncica Rakic","30 of 30","2021-07-02 17:06","17:24","17.5","",""
"Patio/Exterior Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Suncica Rakic","5 of 5","2021-07-02 16:59","17:06","7.4","",""
"Parkade Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Casey Leung","30 of 30","2021-07-02 16:20","16:56","36.2","",""
"Patio/Exterior Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Casey Leung","5 of 5","2021-07-02 16:12","16:19","7.3","",""
"Parkade Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Suncica Rakic","30 of 30","2021-07-02 14:04","14:23","18.9","",""
"Patio/Exterior Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Suncica Rakic","5 of 5","2021-07-02 13:57","14:04","7.4","",""
"Parkade Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Tuan Nguyen","30 of 30","2021-07-02 12:34","12:57","22.4","",""
"Parkade Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Shawn Andre","30 of 30","2021-07-02 10:27","10:51","24.6","",""
"Patio/Exterior Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Shawn Andre","5 of 5","2021-07-02 10:18","10:27","8.4","",""
"Parkade Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Tuan Nguyen","30 of 30","2021-07-02 08:59","09:20","20.8","",""
"Parkade Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Casey Leung","30 of 30","2021-07-01 23:17","23:34","17.4","",""
"Patio/Exterior Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Casey Leung","5 of 5","2021-07-01 23:05","23:17","11.8","",""
"Tower Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Suncica Rakic","37 of 37","2021-07-01 22:03","22:36","33.7","",""
"Parkade Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Casey Leung","30 of 30","2021-07-01 20:54","21:15","21.1","",""
"Patio/Exterior Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Casey Leung","5 of 5","2021-07-01 20:46","20:54","8","",""
"Parkade Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Suncica Rakic","30 of 30","2021-07-01 19:40","19:58","18","",""
"Patio/Exterior Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Suncica Rakic","5 of 5","2021-07-01 19:33","19:40","6.5","",""
"Tower Patrol","#VR0000/VR35122","S - M232 - Colliers - Exchange Building","Casey Leung","37 of 37","2021-07-01 18:44","19:30","45.4","",""
`;
patrols = [];
dates = [];

function dateFormatChanger(date) {
  return date.getFullYear() + '-' + ("0" + (date.getMonth() + 1)).slice(-2) + '-' + ("0" + date.getDate()).slice(-2);
}

class Patrol {
  constructor(tour, account, name, result, startTime, endTime, duration, notes) {
    this.id = this.uuidv4();
    this.tour = tour;
    this.account = account;
    this.name = name;
    this.result = result;
    this.startTime = new Date(startTime.replace(/\"/g, ''));
    let endHourMin = endTime.split(":");
    this.endTime = (new Date(startTime.replace(/\"/g, ''))).setHours(endHourMin[0], endHourMin[1]);
    this.duration = duration;
    this.notes = (notes != '') ? notes : 'None';
  }
  
  uuidv4() {
    return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>
      (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
      );
      
    }
  }
  
  function isInArray(array, value) {
    for (let i = 0; i < array.length; i++) {
    if (value.getTime() == array[i].getTime())
    return i;
  }
  console.log('Value -> ' + value.getTime())
  return false;
}


Date.prototype.withoutTime = function () {
  var d = new Date(this);
  d.setHours(0, 0, 0, 0);
  return d;
}

function handleFileLoad(fileContents) {
  
  patrols = dataParser(fileContents)
  console.log(patrols[012])
  chartData = calendarChartDataOrganizer(patrols)
  
}

function dataParser(data) {
  let results = []
  let rows = data.split('\n');
  for (let i = 1; i < rows.length; i++) {
    let singleRow = rows[i].split(',');
    if (singleRow[0] && singleRow[2] && singleRow[3] && singleRow[4] && singleRow[5] && singleRow[6] && singleRow[7]) {
      let newPatrol = new Patrol(  singleRow[0].replace(/\"/g, ''),
          singleRow[2].replace(/\"/g, ''),
          singleRow[3].replace(/\"/g, ''),
          singleRow[4].replace(/\"/g, ''),
          singleRow[5].replace(/\"/g, ''),
          singleRow[6].replace(/\"/g, ''),
          singleRow[7].replace(/\"/g, ''),
          singleRow[9].replace(/\"/g, ''))
          results.push(
            newPatrol
            );
          }
        }
        return results;
        
      }
      
      function calendarChartDataOrganizer(patrols) {
        let dates = []
        let map = []
        
        for (let i = 0; i < patrols.length; i++) {
          let results = {}
          let datePresent = isInArray(dates, patrols[i].startTime.withoutTime())
          
          if (!datePresent) {
            dates.push(patrols[i].startTime.withoutTime());
            console.log(dateFormatChanger(patrols[i].startTime.withoutTime()))
            let result = {
              "value": 0,
              "day": dateFormatChanger(patrols[i].startTime.withoutTime())
            }
            map.push(result)
          }
          // else{
            //   map[datePresent] = { "value" : ++map[datePresent].value, "day": dateFormatChanger(patrols[i].startTime.withoutTime()) }
            // }
          }
          //console.log(map);
          
          
          
        }
        handleFileLoad(fileContents)
        </script>